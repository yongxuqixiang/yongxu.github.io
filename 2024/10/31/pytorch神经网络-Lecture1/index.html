<!DOCTYPE html><html class="dark" lang="zh-CN"><head><!-- hexo injector head_begin start --><link href="https://cdn.jsdelivr.net/npm/hexo-widget-tree@0.2.3/css/index.css" rel="stylesheet"/><!-- hexo injector head_begin end --><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#6200ee"><meta name="author" content="yongxuqixiang"><meta name="copyright" content="yongxuqixiang"><meta name="generator" content="Hexo 7.3.0"><meta name="theme" content="hexo-theme-yun"><title>å¦‚ä½•å¼€å§‹ä½ çš„ç¬¬ä¸€ä¸ªç¥ç»ç½‘ç»œ | èœ—å±…</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/png" href="/yongxu.github.io/pic1.jpg"><link rel="mask-icon" href="/yongxu.github.io/pic1.jpg" color="#6200ee"><link rel="preload" href="/yongxu.github.io/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/yongxu.github.io/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"yongxuqixiang.github.io","root":"/yongxu.github.io/","title":"èœ—å±…","version":"1.10.11","mode":"dark","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"æœç´¢...","empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹: ${query}","hits":"æ‰¾åˆ° ${hits} æ¡ç»“æœ","hits_time":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"local_search":{"path":"/yongxu.github.io/search.xml"},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/yongxu.github.io/css/hexo-theme-yun.css"><script src="/yongxu.github.io/js/hexo-theme-yun.js" type="module"></script><link rel="stylesheet" href="/yongxu.github.io/css/mycss.css"><script src="/yongxu.github.io/javascript/markdown-it-config.js"></script><meta name="description" content="æœ¬ç¯‡åšå®¢çš„ä¸»è¦å†…å®¹å°†å›´ç»•å¦‚ä½•è®­ç»ƒä½ çš„ç¬¬ä¸€ä¸ªç¥ç»ç½‘ç»œå¹¶å®Œæˆç®€å•çš„åˆ†ç±»ä»»åŠ¡ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="å¦‚ä½•å¼€å§‹ä½ çš„ç¬¬ä¸€ä¸ªç¥ç»ç½‘ç»œ">
<meta property="og:url" content="https://yongxuqixiang.github.io/yongxu.github.io/2024/10/31/pytorch%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C-Lecture1/index.html">
<meta property="og:site_name" content="èœ—å±…">
<meta property="og:description" content="æœ¬ç¯‡åšå®¢çš„ä¸»è¦å†…å®¹å°†å›´ç»•å¦‚ä½•è®­ç»ƒä½ çš„ç¬¬ä¸€ä¸ªç¥ç»ç½‘ç»œå¹¶å®Œæˆç®€å•çš„åˆ†ç±»ä»»åŠ¡ã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yongxuqixiang.github.io/yongxu.github.io/images/pytorch_p1.png">
<meta property="article:published_time" content="2024-10-31T15:15:17.774Z">
<meta property="article:modified_time" content="2024-11-03T07:49:58.769Z">
<meta property="article:author" content="yongxuqixiang">
<meta property="article:tag" content="deep-learning, pytorch">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yongxuqixiang.github.io/yongxu.github.io/images/pytorch_p1.png"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/yongxu.github.io/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/yongxu.github.io/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="æ–‡ç« ç›®å½•"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="ç«™ç‚¹æ¦‚è§ˆ"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info mickey-mouse"><a class="site-author-avatar" href="/yongxu.github.io/about/" title="yongxuqixiang"><img width="96" loading="lazy" src="/yongxu.github.io/pic1.jpg" alt="yongxuqixiang"><span class="site-author-status" title="study">ğŸ˜Š</span></a><div class="site-author-name"><a href="/yongxu.github.io/about/">yongxuqixiang</a></div><a class="site-name" href="/yongxu.github.io/about/site.html">èœ—å±…</a><sub class="site-subtitle"></sub><div class="site-description"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/yongxu.github.io/" title="æˆ‘çš„ä¸»é¡µ"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/yongxu.github.io/archives/" title="å½’æ¡£"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">4</span></a></div><div class="site-state-item"><a href="/yongxu.github.io/categories/" title="åˆ†ç±»"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">3</span></a></div><div class="site-state-item"><a href="/yongxu.github.io/tags/" title="æ ‡ç­¾"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">3</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="æ–‡æ¡£"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:settings-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/yongxuqixiang" title="github" target="_blank" style="color:#181717"><span class="icon iconify" data-icon="ri:github-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.google.com" title="google" target="_blank" style="color:undefined"><span class="icon iconify" data-icon="ri:google-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.bilibili.com" title="bilbil" target="_blank" style="color:#1E90FF"><span class="icon iconify" data-icon="ri:bilibili-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/" title="music" target="_blank" style="color:#F50057"><span class="icon iconify" data-icon="ri:music-line"></span></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/yongxu.github.io/links/" title="å¸¸ç”¨é“¾æ¥" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a></div></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.</span> <span class="toc-text">ç¯å¢ƒæ­å»º</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Step-1-%E4%B8%8B%E8%BD%BDAnaconda"><span class="toc-number">1.0.1.</span> <span class="toc-text">Step 1 ä¸‹è½½Anaconda</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Step-2-%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83"><span class="toc-number">1.0.2.</span> <span class="toc-text">Step 2 åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Step-3-%E5%AE%89%E8%A3%85pycharm"><span class="toc-number">1.0.3.</span> <span class="toc-text">Step 3 å®‰è£…pycharm</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%AD%E7%BB%83%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text">è®­ç»ƒä½ çš„ç¬¬ä¸€ä¸ªæ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Step-1-%E4%B8%8B%E8%BD%BD%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">2.0.1.</span> <span class="toc-text">Step 1 ä¸‹è½½æ•°æ®é›†</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Step-2-%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86"><span class="toc-number">2.0.2.</span> <span class="toc-text">Step 2 æ•°æ®é¢„å¤„ç†</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Step-3-%E5%88%86%E5%89%B2%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">2.0.3.</span> <span class="toc-text">Step 3 åˆ†å‰²æ•°æ®é›†</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Step-4-%E6%9E%84%E5%BB%BA%E7%BD%91%E7%BB%9C"><span class="toc-number">2.0.4.</span> <span class="toc-text">Step 4 æ„å»ºç½‘ç»œ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Step-5-%E8%AE%AD%E7%BB%83%E7%BD%91%E7%BB%9C"><span class="toc-number">2.0.5.</span> <span class="toc-text">Step 5 è®­ç»ƒç½‘ç»œ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Step-6-%E6%8E%A2%E7%A9%B6%E5%85%A8%E8%BF%9E%E6%8E%A5%E7%BD%91%E7%BB%9C"><span class="toc-number">2.0.6.</span> <span class="toc-text">Step 6 æ¢ç©¶å…¨è¿æ¥ç½‘ç»œ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-number">3.</span> <span class="toc-text">å®Œæ•´ä»£ç </span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#6200ee;"><link itemprop="mainEntityOfPage" href="https://yongxuqixiang.github.io/yongxu.github.io/yongxu.github.io/2024/10/31/pytorch%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C-Lecture1/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="yongxuqixiang"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="èœ—å±…"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">å¦‚ä½•å¼€å§‹ä½ çš„ç¬¬ä¸€ä¸ªç¥ç»ç½‘ç»œ</h1><div class="post-meta"><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="æœ¬æ–‡å­—æ•°"><span class="icon iconify" data-icon="ri:file-word-line"></span></span> <span title="æœ¬æ–‡å­—æ•°">3.4k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="é˜…è¯»æ—¶é•¿"><span class="icon iconify" data-icon="ri:timer-line"></span></span> <span title="é˜…è¯»æ—¶é•¿">15m</span></span></span><span class="post-busuanzi"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="é˜…è¯»æ¬¡æ•°"><span class="icon iconify" data-icon="ri:eye-line"></span> <span id="busuanzi_value_page_pv"></span></span></span><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/yongxu.github.io/categories/deep-learning/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">deep-learning</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/yongxu.github.io/tags/deep-learning-pytorch/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">deep-learning, pytorch</span></a></span></div><div class="post-author"><span class="author-name">yongxu</span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><p>è¿™ç¯‡åšå®¢çš„ä¸»è¦å†…å®¹å°†å›´ç»•<strong>å¦‚ä½•è®­ç»ƒä½ çš„ç¬¬ä¸€ä¸ªç¥ç»ç½‘ç»œå¹¶å®Œæˆç®€å•çš„åˆ†ç±»ä»»åŠ¡</strong></p>
<h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a><strong>ç¯å¢ƒæ­å»º</strong></h3><hr>
<p>æˆ‘ä»¬é€‰æ‹©Pycharmä½œä¸ºå¼€å‘çš„IDEç¯å¢ƒï¼Œä½¿ç”¨condaç®¡ç†è™šæ‹Ÿç¯å¢ƒã€‚</p>
<h5 id="Step-1-ä¸‹è½½Anaconda"><a href="#Step-1-ä¸‹è½½Anaconda" class="headerlink" title="Step 1 ä¸‹è½½Anaconda"></a>Step 1 ä¸‹è½½Anaconda</h5><hr>
<p>å‰å¾€å®˜ç½‘ä¸‹è½½Anacondaï¼Œå¹¶å®Œæˆå®‰è£…<br><a target="_blank" rel="noopener" href="https://www.anaconda.com/">condaå®˜ç½‘</a><br>å®‰è£…å®Œæˆåï¼Œæ‰“å¼€å‘½ä»¤è¡Œç»ˆç«¯å¹¶è¾“å…¥ä¸‹é¢æŒ‡ä»¤</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda <span class="token parameter variable">-V</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>è‹¥æ˜¾ç¤ºcondaç³»ç»Ÿä¿¡æ¯ï¼Œåˆ™å·²å®Œæˆå®‰è£…</p>
<h5 id="Step-2-åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ"><a href="#Step-2-åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ" class="headerlink" title="Step 2 åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ"></a>Step 2 åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</h5><hr>
<p>è¾“å…¥ä¸‹é¢ç»ˆç«¯æŒ‡ä»¤ï¼Œåˆ›å»ºpythonè™šæ‹Ÿç¯å¢ƒ</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// æŸ¥çœ‹è™šæ‹Ÿç¯å¢ƒ
conda <span class="token function">env</span> list
// åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
// <span class="token string">'myenv'</span>æ›¿æ¢æˆä½ å–œæ¬¢çš„è™šæ‹Ÿç¯å¢ƒåç§°
// <span class="token assign-left variable">python</span><span class="token operator">=</span><span class="token number">3.5</span>è¡¨ç¤ºæŒ‡å®špythonç‰ˆæœ¬ä¸º3.5
conda create <span class="token parameter variable">--name</span> myenv <span class="token assign-left variable">python</span><span class="token operator">=</span><span class="token number">3.5</span>
// å†æ¬¡æŸ¥çœ‹è™šæ‹Ÿç¯å¢ƒï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°åˆšåˆšæ–°å»ºçš„ç¯å¢ƒ
conda <span class="token function">env</span> list<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç¯å¢ƒåˆ›å»ºåï¼Œå¯ä»¥åœ¨ä½ å¸Œæœ›è¿›è¡Œpythonå¼€å‘çš„æ–‡ä»¶ä½ç½®æ‰“å¼€ä¸€ä¸ªç»ˆç«¯<br>è¾“å…¥ä¸‹é¢çš„æŒ‡ä»¤ï¼Œæ¿€æ´»pythonè™šæ‹Ÿç¯å¢ƒï¼ˆæŒ‡ç»ˆç«¯è¿›å…¥pythonæ§åˆ¶å°ï¼‰</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// <span class="token string">'myenv'</span>æ›¿æ¢æˆä½ å¸Œæœ›æ¿€æ´»çš„ç¯å¢ƒåç§°
activate myenv
// å¯ä»¥ä½¿ç”¨è¿™ä¸ªæŒ‡ä»¤ç¦»å¼€è™šæ‹Ÿç¯å¢ƒ
deavtivete
// è¿™ä¸ªæŒ‡ä»¤å¯ä»¥åˆ é™¤è™šæ‹Ÿç¯å¢ƒ
conda remove <span class="token parameter variable">--name</span> myenv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œå¯ä»¥åº”ç”¨ä¸€äº›condaæŒ‡ä»¤ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda list //æŸ¥çœ‹æœ‰ä»€ä¹ˆåŒ…
conda <span class="token function">install</span> xxxx // å®‰è£…ç‰¹å®šåŒ…<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h5 id="Step-3-å®‰è£…pycharm"><a href="#Step-3-å®‰è£…pycharm" class="headerlink" title="Step 3 å®‰è£…pycharm"></a>Step 3 å®‰è£…pycharm</h5><hr>
<p>å‰å¾€å®˜ç½‘å®‰è£…pycharm<br><a target="_blank" rel="noopener" href="https://www.jetbrains.com/pycharm/">å®˜ç½‘</a><br>å®‰è£…æ—¶å¯ä»¥é€‰æ‹©å°†vscodeé£æ ¼å’Œæ’ä»¶ä¸€é”®ç§»æ¤åˆ°pycharm<br>å®‰è£…å®Œæˆåï¼Œæ–°å»ºä¸€ä¸ªé¡¹ç›®<br><img src="/yongxu.github.io/images/pytorch_p1.png" loading="lazy"><br>pythonè·¯å¾„é€‰æ‹©ä½ åˆšåˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒï¼Œé€‰æ‹©å…¶ä¸­çš„python.exeæ–‡ä»¶å³å¯<br>è‡³æ­¤ï¼Œä½ å·²ç»å®Œæˆå…¨éƒ¨ç¯å¢ƒé…ç½®ï¼Œå¯ä»¥å°è¯•è¿è¡Œç®€å•pythonç¨‹åº<br>æ–°å»ºpythonç¨‹åºï¼Œè¾“å…¥ä¸‹é¢çš„ä»£ç å¹¶è¿è¡Œï¼Œæ£€æŸ¥è§£é‡Šå™¨æ˜¯å¦å®Œæˆé…ç½®</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>Hello World<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="è®­ç»ƒä½ çš„ç¬¬ä¸€ä¸ªæ¨¡å‹"><a href="#è®­ç»ƒä½ çš„ç¬¬ä¸€ä¸ªæ¨¡å‹" class="headerlink" title="è®­ç»ƒä½ çš„ç¬¬ä¸€ä¸ªæ¨¡å‹"></a><strong>è®­ç»ƒä½ çš„ç¬¬ä¸€ä¸ªæ¨¡å‹</strong></h3><hr>
<p>æˆ‘ä»¬é€‰æ‹©ä»<a target="_blank" rel="noopener" href="https://www.kaggle.com/">Kaggle</a>ä¸Šè·å–å¼€æºæ•°æ®ï¼Œè¿›è¡Œç½‘ç»œè®­ç»ƒã€‚</p>
<h5 id="Step-1-ä¸‹è½½æ•°æ®é›†"><a href="#Step-1-ä¸‹è½½æ•°æ®é›†" class="headerlink" title="Step 1 ä¸‹è½½æ•°æ®é›†"></a>Step 1 ä¸‹è½½æ•°æ®é›†</h5><hr>
<p>å‰å¾€å®˜ç½‘<a target="_blank" rel="noopener" href="https://www.kaggle.com/datasets/rahmasleam/bird-speciees-dataset">Bird Speciees Dataset</a><br>ç›´æ¥ä¸‹è½½æ•°æ®é›†å¹¶è§£å‹åˆ°å·¥ä½œç›®å½•<br>ä½ å¯ä»¥æ£€æŸ¥æ–‡ä»¶å¤¹ä¸­çš„å„ä¸ªå›¾ç‰‡ï¼Œåº”è¯¥æ˜¯å…­ç§ç‰¹å¾æ˜æ˜¾çš„é¸Ÿç±»ã€‚<br>æ£€æŸ¥æ— è¯¯åæˆ‘ä»¬å°†å¼€å§‹ç¼–å†™ç¨‹åºã€‚</p>
<h5 id="Step-2-æ•°æ®é¢„å¤„ç†"><a href="#Step-2-æ•°æ®é¢„å¤„ç†" class="headerlink" title="Step 2 æ•°æ®é¢„å¤„ç†"></a>Step 2 æ•°æ®é¢„å¤„ç†</h5><hr>
<p>ä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬éœ€è¦å¯¹è¾“å…¥çš„å›¾åƒæ–‡ä»¶è¿›è¡Œä¸€äº›å¤„ç†ï¼ŒåŒ…æ‹¬</p>
<ul>
<li>å›¾åƒå¯¹é½(224x224)</li>
<li>å°†ç±»å‹è½¬æ¢ä¸ºtensorå¼ é‡</li>
<li>å°†åƒç´ å€¼å½’ä¸€åŒ–åˆ°0~1</li>
<li>(å¯é€‰)å°†å›¾ç‰‡åƒç´ å€¼å‡å€¼å¤„ç†æˆ0ï¼Œä¿æŒä¸€å®šæ–¹å·®<br>ä½†æœ¬æ¬¡æˆ‘ä»¬ä¸è¿›è¡Œè¿™æ ·çš„æ“ä½œï¼Œå› ä¸ºé¢„å¤„ç†çš„ä¸»è¦ç›®çš„æ˜¯åŠ å¿«è®­ç»ƒé€Ÿåº¦å’Œæé«˜æ€§èƒ½ï¼Œ<br>è€Œè¿™ä¸ªæ•°æ®é›†ç‰¹å¾æå…¶æ˜æ˜¾ï¼Œå› æ­¤ä¸è¿›è¡Œé¢„å¤„ç†å¯¹ç»“æœå½±å“ä¸å¤§ã€‚</li>
</ul>
<h5 id="Step-3-åˆ†å‰²æ•°æ®é›†"><a href="#Step-3-åˆ†å‰²æ•°æ®é›†" class="headerlink" title="Step 3 åˆ†å‰²æ•°æ®é›†"></a>Step 3 åˆ†å‰²æ•°æ®é›†</h5><hr>
<p>é¦–å…ˆï¼Œä¸‹é¢æ˜¯ä½ éœ€è¦å¼•å…¥çš„æ‰€æœ‰åŒ…ï¼Œåœ¨æ–‡ä»¶å¼€å¤´å†™å…¥å³å¯<br>ï¼ˆæ³¨æ„ï¼Œå¤§éƒ¨åˆ†åŒ…ä½ åº”è¯¥éƒ½æ²¡ä¸‹è½½è¿‡ï¼Œéœ€è¦é€šè¿‡åŒ…ç®¡ç†ä¸‹è½½ï¼Œä½†ä¸ç”¨æ‹…å¿ƒï¼Œå…ˆå¾€ä¸‹çœ‹ï¼‰</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch  
<span class="token keyword">import</span> os  
  
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image  
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> LabelEncoder  
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split  
<span class="token keyword">from</span> sympy <span class="token keyword">import</span> viete  
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>backcompat <span class="token keyword">import</span> keepdim_warning  
<span class="token keyword">from</span> torchvision<span class="token punctuation">.</span>transforms <span class="token keyword">import</span> ToTensor  
<span class="token keyword">from</span> torch <span class="token keyword">import</span> cuda<span class="token punctuation">,</span> nn<span class="token punctuation">,</span> optim  
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F  
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">import</span> DataLoader  
<span class="token keyword">from</span> tqdm <span class="token keyword">import</span> tqdm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>pycharmæ‹¥æœ‰å¿«é€Ÿä¿®å¤åŠŸèƒ½ï¼Œå¦‚æœä½ å‘ç°ä»£ç ä¸­å‡ºç°çº¢è‰²æ³¢æµªï¼Œå°†é¼ æ ‡æ”¾åœ¨å…¶ä¸Šï¼Œä¼šå‡ºç°å¿«é€Ÿä¿®å¤åŠŸèƒ½ï¼Œç‚¹å‡»åpycharmä¼šè‡ªåŠ¨è°ƒåŒ…ç®¡ç†æ’ä»¶ï¼Œä¸‹è½½æ‰€éœ€çš„åŒ…ï¼Œå¹¶å®Œæˆimportã€‚<br>å› æ­¤ï¼Œä½ å¯ä»¥è½»æ¾åœ°å®Œæˆæ‰€éœ€åŒ…çš„ä¸‹è½½ã€‚<br>æ¥ä¸‹æ¥è¿›è¡Œæ•°æ®é›†åˆ†å‰²ï¼Œå°†å…¶åˆ†æˆè®­ç»ƒé›†ã€æµ‹è¯•é›†å’ŒéªŒè¯é›†ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">path <span class="token operator">=</span> <span class="token string">"Bird Species Dataset"</span>  
  
data_dir <span class="token operator">=</span> path  
images <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  
labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  
<span class="token comment"># æŒ‰é¡ºåºè¯»å–æ‰€æœ‰å›¾åƒæ–‡ä»¶ </span>
<span class="token keyword">for</span> root<span class="token punctuation">,</span> dirs<span class="token punctuation">,</span> files <span class="token keyword">in</span> os<span class="token punctuation">.</span>walk<span class="token punctuation">(</span>data_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    <span class="token keyword">for</span> f <span class="token keyword">in</span> files<span class="token punctuation">:</span>  
        <span class="token keyword">if</span> f<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'.jpg'</span><span class="token punctuation">)</span> <span class="token keyword">or</span> f<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'.png'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
            file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root<span class="token punctuation">,</span> f<span class="token punctuation">)</span>  
            <span class="token comment"># å­ç›®å½•åç§°ä½œä¸ºæ ‡ç­¾  </span>
            label <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>root<span class="token punctuation">)</span>  
            images<span class="token punctuation">.</span>append<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>  
            labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">)</span>  
<span class="token comment"># å°†å­—ç¬¦ä¸²çš„labelç¼–ç æˆæ•°å­—</span>
le <span class="token operator">=</span> LabelEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span>  
encoded_labels <span class="token operator">=</span> le<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>labels<span class="token punctuation">)</span>  
<span class="token comment"># ç¬¬ä¸€æ­¥ï¼šå…ˆå°†æ•´ä¸ªæ•°æ®é›†åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œå…¶ä»–(è¿™é‡ŒåŒ…æ‹¬éªŒè¯é›†+æµ‹è¯•é›†)  </span>
train_images<span class="token punctuation">,</span> temp_images<span class="token punctuation">,</span> train_labels<span class="token punctuation">,</span> tmp_labels <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>images<span class="token punctuation">,</span> encoded_labels<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span> stratify<span class="token operator">=</span>labels<span class="token punctuation">)</span>  <span class="token comment"># 70% è®­ç»ƒ, 30% å…¶ä»–  </span>
  
<span class="token comment"># ç¬¬äºŒæ­¥ï¼šä»å‰©ä½™çš„æ•°æ®é›†ä¸­å†åˆ’åˆ†å‡ºéªŒè¯é›†å’Œæµ‹è¯•é›†  </span>
val_images<span class="token punctuation">,</span> test_images<span class="token punctuation">,</span> val_labels<span class="token punctuation">,</span> test_labels  <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>temp_images<span class="token punctuation">,</span> tmp_labels<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span> stratify<span class="token operator">=</span>tmp_labels<span class="token punctuation">)</span>  <span class="token comment"># 15% éªŒè¯, 15% æµ‹è¯•  </span>
  
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"è®­ç»ƒé›†å¤§å°: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>train_images<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>  
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"éªŒè¯é›†å¤§å°: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>val_images<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>  
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"æµ‹è¯•é›†å¤§å°: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>test_images<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä½ å¯ä»¥è¿è¡Œæ–‡ä»¶ï¼ŒæŸ¥çœ‹æ•°æ®é›†å¤§å°æ˜¯å¦æ­£ç¡®</p>
<h5 id="Step-4-æ„å»ºç½‘ç»œ"><a href="#Step-4-æ„å»ºç½‘ç»œ" class="headerlink" title="Step 4 æ„å»ºç½‘ç»œ"></a>Step 4 æ„å»ºç½‘ç»œ</h5><hr>
<p>æœ¬æ¬¡å®éªŒæˆ‘ä»¬åˆ†åˆ«æ„é€ å…¨è¿æ¥ç½‘ç»œå’Œå·ç§¯ç½‘ç»œï¼Œå¹¶æ¯”è¾ƒæ€§èƒ½å·®åˆ«<br>ä¸¤ä¸ªç½‘ç»œåˆ†åˆ«ç»§æ‰¿nn.Moduleè¿™ä¸ªåŸºç±»ï¼ˆpytorchåŒ…å†…å·²ç»å†™å¥½äº†ï¼‰<br>super.init()è¡¨ç¤ºä½¿ç”¨çˆ¶ç±»çš„åˆå§‹åŒ–ï¼Œå¯ä»¥å°±ç†è§£ä¸ºåˆå§‹åŒ–<br>nn.Linearå’Œnn.Conv2dä¹Ÿéƒ½æ˜¯pytorchå·²ç»å®ç°çš„è¿æ¥å±‚å’Œå·ç§¯å±‚<br>nn.MaxPool2dåˆ™æ˜¯æ± åŒ–å±‚ï¼Œé‡‡ç”¨2x2çš„ä¸‹é‡‡æ ·<br>F.reluä¹Ÿæ˜¯pytorchå·²ç»å®ç°çš„å‡½æ•°ï¼Œæˆ‘ä»¬åœ¨å¼€å¤´å·²ç»å¯¼å…¥äº†</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Liner</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_size <span class="token operator">=</span> <span class="token number">3</span><span class="token operator">*</span><span class="token number">224</span><span class="token operator">*</span><span class="token number">224</span><span class="token punctuation">,</span> hidden_size<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
        <span class="token builtin">super</span><span class="token punctuation">(</span>Liner<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>  
        self<span class="token punctuation">.</span>fc1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>input_size<span class="token punctuation">,</span> hidden_size<span class="token punctuation">)</span>  
        self<span class="token punctuation">.</span>fc2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_size<span class="token punctuation">,</span>   <span class="token number">6</span><span class="token punctuation">)</span>  
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>  
        x <span class="token operator">=</span> x<span class="token punctuation">.</span>view<span class="token punctuation">(</span>x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>fc1<span class="token punctuation">(</span>x<span class="token punctuation">)</span>  
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>x<span class="token punctuation">)</span>  
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>fc2<span class="token punctuation">(</span>x<span class="token punctuation">)</span>  
        <span class="token keyword">return</span> x  
  
<span class="token keyword">class</span> <span class="token class-name">CNN</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num_classes <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span> in_channels <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
        <span class="token builtin">super</span><span class="token punctuation">(</span>CNN<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>  
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels <span class="token operator">=</span> in_channels <span class="token punctuation">,</span> out_channels <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  
        self<span class="token punctuation">.</span>pool1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>  
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels <span class="token operator">=</span> <span class="token number">16</span> <span class="token punctuation">,</span> out_channels <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">,</span>  kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  
        self<span class="token punctuation">.</span>fc1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>in_features <span class="token operator">=</span> <span class="token number">32</span> <span class="token operator">*</span> <span class="token number">112</span> <span class="token operator">*</span> <span class="token number">112</span><span class="token punctuation">,</span> out_features <span class="token operator">=</span>  num_classes<span class="token punctuation">)</span>
  
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>  
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>  
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>pool1<span class="token punctuation">(</span>x<span class="token punctuation">)</span>  
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> 
        x <span class="token operator">=</span> x<span class="token punctuation">.</span>view<span class="token punctuation">(</span>x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>fc1<span class="token punctuation">(</span>x<span class="token punctuation">)</span>  
        <span class="token keyword">return</span> x<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬ç½‘ç»œçš„ç»“æ„å’Œå‘å‰ä¼ æ’­å·²ç»æ„é€ å®Œæˆã€‚<br>ç”±äºpytorchä¸éœ€è¦æˆ‘ä»¬æ˜¾å¼å®ç°å‘åä¼ æ’­è®¡ç®—æ¢¯åº¦ï¼Œè€Œæ˜¯åœ¨<strong>åç»­è®¡ç®—è¿‡ç¨‹ç”Ÿæˆè®¡ç®—å›¾</strong>ï¼Œæ¥è®¡ç®—å‘åä¼ æ’­çš„æ¢¯åº¦ã€‚æ‰€ä»¥æ•´ä¸ªç½‘ç»œå·²ç»æ­å»ºå®Œæˆã€‚</p>
<h5 id="Step-5-è®­ç»ƒç½‘ç»œ"><a href="#Step-5-è®­ç»ƒç½‘ç»œ" class="headerlink" title="Step 5 è®­ç»ƒç½‘ç»œ"></a>Step 5 è®­ç»ƒç½‘ç»œ</h5><hr>
<p>æˆ‘ä»¬ç°åœ¨å·²ç»æ‹¥æœ‰äº†ä¸€ç»„å›¾ç‰‡çš„tensorå¼ é‡ä»¥åŠå’Œå®ƒä¸€ä¸€å¯¹åº”çš„æ ‡ç­¾ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸èƒ½æŠŠè¿™ä¹ˆå¤šå›¾ç‰‡ä¸€èµ·å…¨éƒ½æ‰”è¿›ç½‘ç»œè®­ç»ƒï¼Œå› ä¸ºæˆ‘ä»¬çš„æ˜¾å­˜ï¼ˆå¦‚æœæ˜¯CPUè®­ç»ƒå°±æ˜¯CPUå†…å­˜ï¼‰æ²¡æœ‰è¿™ä¹ˆå¤§(ä½ å¯ä»¥å…¨éƒ½æ‰”è¿›å»è¯•è¯•:))ã€‚<br>æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨æ¯è½®è®­ç»ƒæ—¶ä»trainæ ·æœ¬ä¸­ä¸é‡å¤çš„æŠ½å–ä¸€ç»„ï¼Œæ¥è¿›è¡Œå‘å‰ä¼ æ’­å’Œå‘åä¼ æ’­ã€‚<br>æˆ‘ä»¬ç§°ä¸ºbatch_sizeã€‚<br>æˆ‘ä»¬åŒæ ·å€ŸåŠ©torchæ¥å®ç°ã€‚<br>å®šä¹‰ä¸€ä¸ªé¸Ÿçš„æ•°æ®ç±»ï¼Œç»§æ‰¿è‡ªtorchçš„Datasetã€‚<br>transformä¸»è¦æ˜¯è®²å›¾åƒçš„ç±»å‹è½¬æ¢ä¸ºtensorï¼Œä¾¿äºå‰é¢å®šä¹‰çš„ç½‘ç»œä½¿ç”¨ã€‚<br>getitemæ˜¯ä¸»è¦ä½¿ç”¨çš„æ–¹æ³•ï¼Œå°±æ˜¯éšæœºç”Ÿæˆç´¢å¼•ï¼Œå¹¶å–å‡ºimageså’Œlabelså¯¹åº”çš„æ•°æ®ã€‚<br>ä½¿ç”¨è¿™ä¸ªç±»çš„å¥½å¤„åœ¨åé¢ä½¿ç”¨çš„æ—¶å€™å°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨éšæœºå–æ ·ï¼Œå¹¶ä¸”å¾ªç¯è°ƒç”¨ï¼Œä¸”ä¸ä¼šé‡å¤å–æ ·ï¼Œå¯ä»¥ä¿è¯ä¸€è½®è®­ç»ƒæ°å¥½ç”¨å®Œæ‰€ä»¥trainæ ·æœ¬ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">BirdDataset</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> images<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> transform<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
        self<span class="token punctuation">.</span>images <span class="token operator">=</span> images  
        self<span class="token punctuation">.</span>labels <span class="token operator">=</span> labels  
        self<span class="token punctuation">.</span>transform <span class="token operator">=</span> transform <span class="token keyword">if</span> transform <span class="token keyword">else</span> ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span>  
  
    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>  
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>images<span class="token punctuation">)</span>  
    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>  
        img_path <span class="token operator">=</span> self<span class="token punctuation">.</span>images<span class="token punctuation">[</span>index<span class="token punctuation">]</span>  
        label <span class="token operator">=</span> self<span class="token punctuation">.</span>labels<span class="token punctuation">[</span>index<span class="token punctuation">]</span>  
        label <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span>  
  
        <span class="token comment"># åŠ è½½å›¾åƒå¹¶è½¬æ¢ä¸ºPILå›¾åƒ  </span>
        image <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>img_path<span class="token punctuation">)</span>  
  
        <span class="token comment"># åº”ç”¨å˜æ¢</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>transform<span class="token punctuation">:</span>  
            image <span class="token operator">=</span> self<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>image<span class="token punctuation">)</span>  
  
        <span class="token comment"># è¿”å›å›¾åƒæ•°æ®å’Œå¯¹åº”æ ‡ç­¾  </span>
        <span class="token keyword">return</span> image<span class="token punctuation">,</span> label<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è°ƒç”¨ä¸Šé¢å†™çš„ç½‘ç»œç±»å’Œæ•°æ®é›†ç±»ï¼Œæ¥è¿›è¡Œè®­ç»ƒã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># ä½¿ç”¨GPUè®­ç»ƒï¼Œå¦‚æœéœ€è¦çš„è¯è¦è‡ªè¡Œé…ç½®cudaï¼Œç¬¬ä¸€æ¬¡è®­ç»ƒå¯ä»¥å…ˆä¸ç”¨</span>
device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">"cuda"</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"cpu"</span><span class="token punctuation">)</span>  
<span class="token comment"># æ¯æ¬¡é‡‡æ ·å¤§å°ï¼Œä¸€èˆ¬128å’Œ64æ˜¯ä¸ªåˆé€‚çš„å€¼</span>
batch_size <span class="token operator">=</span> <span class="token number">64</span> 
<span class="token comment"># è®­ç»ƒè½®æ•°ï¼Œtrainä¸­æ‰€æœ‰æ ·æœ¬è®­ç»ƒè¿‡ä¸€æ¬¡ç®—ä¸€è½®</span>
num_epochs <span class="token operator">=</span> <span class="token number">10</span>  
<span class="token comment"># å­¦ä¹ ç‡ï¼Œä¸€ä¸ªè¾ƒå¤§çš„å­¦ä¹ ç‡ä¼šå¯¼è‡´æŒ¯è¡ï¼Œ1e-3å’Œ1e-4æ˜¯ä¸ªåˆé€‚çš„å€¼</span>
learning_rate <span class="token operator">=</span> <span class="token number">1e-3</span>  
<span class="token comment"># å®šä¹‰æˆ‘ä»¬çš„æ¨¡å‹</span>
model <span class="token operator">=</span> CNN<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>  
<span class="token comment"># ä¸‹é¢æ˜¯å…¨è¿æ¥ç½‘ç»œï¼Œåˆ‡æ¢ç½‘ç»œæ—¶æ”¹å˜æ³¨é‡Šå³å¯</span>
<span class="token comment"># model = Liner().to(device)  </span>
<span class="token comment"># é‡‡ç”¨torchåŒ…å†…çš„äº¤å‰ç†µæŸå¤±å‡½æ•°</span>
<span class="token comment"># è¯„ä¼°ä½ æ¨¡å‹çš„ä¼˜åŠ£ï¼Œä¸ºä¸‹ä¸€æ­¥è®­ç»ƒæä¾›æ›´æ–°ä¾æ®</span>
criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>  
<span class="token comment"># æ¢¯åº¦æ›´æ–°å™¨ï¼Œé€‰ç”¨Adamæ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¿«é€Ÿçš„æ¢¯åº¦ä¸‹é™æ–¹æ³•</span>
<span class="token comment"># å¯ä»¥ç†è§£ä¸ºä»–ä¼šæ ¹æ®ä½ å‰ä¸€æ­¥çš„æŸå¤±ï¼Œè€ƒè™‘å¤šå¤§ç¨‹åº¦åœ°æ”¹å˜æ¨¡å‹å‚æ•°</span>
optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>learning_rate<span class="token punctuation">)</span>  
<span class="token comment"># åˆ¶ä½œæ•°æ®é›†åŠ è½½å™¨ï¼ŒDataLoaderåŒæ ·æ˜¯torchåŒ…å†…å†™å¥½çš„</span>
train_data <span class="token operator">=</span> BirdDataset<span class="token punctuation">(</span>train_images<span class="token punctuation">,</span> train_labels<span class="token punctuation">,</span> transform<span class="token operator">=</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
train_loader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>dataset <span class="token operator">=</span> train_data<span class="token punctuation">,</span> batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  
test_data <span class="token operator">=</span> BirdDataset<span class="token punctuation">(</span>test_images<span class="token punctuation">,</span> test_labels<span class="token punctuation">,</span> transform<span class="token operator">=</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
test_loader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>dataset <span class="token operator">=</span> test_data<span class="token punctuation">,</span> batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  
<span class="token comment"># å¼€å§‹è®­ç»ƒ</span>
<span class="token comment"># ä¸¤å±‚å¾ªç¯ï¼Œç¬¬ä¸€å±‚è®­ç»ƒè½®æ•°</span>
<span class="token comment"># ç¬¬äºŒå±‚æ˜¯å¯¹trainè¿›è¡Œçš„åå¤é‡‡æ ·ç›´åˆ°éå†å®Œtrain</span>
<span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Epoch [</span><span class="token interpolation"><span class="token punctuation">&#123;</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>num_epochs<span class="token punctuation">&#125;</span></span><span class="token string">]"</span></span><span class="token punctuation">)</span>  
    <span class="token comment"># enumerateç”¨äºéå†train_loaderè¿™ä¸ªåºåˆ—</span>
    <span class="token comment"># å› ä¸ºtrain_loaderæœ¬èº«åªèƒ½æ ¹æ®ç´¢å¼•é‡‡æ ·æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦enumerateæä¾›éå†çš„ç´¢å¼•</span>
    <span class="token keyword">for</span> batch_index<span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">,</span> targets<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>train_loader<span class="token punctuation">)</span><span class="token punctuation">:</span>  
        image <span class="token operator">=</span> data<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>  
        label <span class="token operator">=</span> targets<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>  
        <span class="token comment"># å‘å‰ä¼ æ’­ï¼Œè®¡ç®—å¾—åˆ†ï¼ŒåŒæ—¶æ¸…ç©ºæ¢¯åº¦ï¼Œå¼€å§‹äº§ç”Ÿæ¢¯åº¦è®¡ç®—å›¾</span>
        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>  
        score <span class="token operator">=</span> model<span class="token punctuation">(</span>image<span class="token punctuation">)</span>  
        loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>score<span class="token punctuation">,</span> label<span class="token punctuation">)</span>  
        <span class="token comment"># å‘åä¼ æ’­</span>
        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>  
        <span class="token comment"># æ›´æ–°æ¨¡å‹å‚æ•°</span>
        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>  
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"loss: "</span><span class="token punctuation">,</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
    <span class="token comment"># ä¸‹é¢æ˜¯æˆ‘ä»¬å†™çš„è§‚å¯Ÿæ¨¡å‹å‡†ç¡®ç‡çš„å‡½æ•°</span>
    train_accuracy <span class="token operator">=</span> check_accuracy<span class="token punctuation">(</span>train_loader<span class="token punctuation">,</span> model<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>  
    test_accuracy <span class="token operator">=</span>  check_accuracy<span class="token punctuation">(</span>test_loader<span class="token punctuation">,</span> model<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è‡³æ­¤ï¼Œæ•´ä¸ªæ¨¡å‹è®­ç»ƒå°±å·²ç»å®Œæˆï¼Œä¸‹é¢é™„ä¸Šæ£€éªŒæ­£ç¡®ç‡çš„å‡½æ•°ï¼Œè¯·ä½ åœ¨æ¨¡å‹è®­ç»ƒå‰å…ˆå¯¹å…¶å£°æ˜</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">check_accuracy</span><span class="token punctuation">(</span>loader<span class="token punctuation">,</span> model<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    num_correct <span class="token operator">=</span> <span class="token number">0</span>  
    num_samples <span class="token operator">=</span> <span class="token number">0</span>  
    model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>  
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Checking accuracy on training data"</span><span class="token punctuation">)</span>  
    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>  
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Checking accuracy on test data"</span><span class="token punctuation">)</span>  
    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>  
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Checking accuracy on validation data"</span><span class="token punctuation">)</span>  
  
    <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
        <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> loader<span class="token punctuation">:</span>  
            x <span class="token operator">=</span> x<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>  
            y <span class="token operator">=</span> y<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>  
  
            scores <span class="token operator">=</span> model<span class="token punctuation">(</span>x<span class="token punctuation">)</span>  
            _<span class="token punctuation">,</span> predictions <span class="token operator">=</span> scores<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  
            num_correct <span class="token operator">+=</span> <span class="token punctuation">(</span>predictions <span class="token operator">==</span> y<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
            num_samples <span class="token operator">+=</span> predictions<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  
  
        <span class="token comment"># Calculate accuracy  </span>
        accuracy <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>num_correct<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">float</span><span class="token punctuation">(</span>num_samples<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span>  
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Got </span><span class="token interpolation"><span class="token punctuation">&#123;</span>num_correct<span class="token punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>num_samples<span class="token punctuation">&#125;</span></span><span class="token string"> with accuracy </span><span class="token interpolation"><span class="token punctuation">&#123;</span>accuracy<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">&#125;</span></span><span class="token string">%"</span></span><span class="token punctuation">)</span>  
  
    model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> accuracy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æœ€åï¼Œä½ å¯ä»¥ç”¨ä½ çš„æ¨¡å‹å¯¹éªŒè¯é›†è¿›è¡Œé¢„æµ‹ï¼Œè¯„ä¼°æ¨¡å‹ä¼˜åŠ£</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">val_data <span class="token operator">=</span> BirdDataset<span class="token punctuation">(</span>val_images<span class="token punctuation">,</span> val_labels<span class="token punctuation">,</span> transform<span class="token operator">=</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
val_loader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>dataset <span class="token operator">=</span> val_data<span class="token punctuation">,</span> batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  
check_accuracy<span class="token punctuation">(</span>val_loader<span class="token punctuation">,</span> model<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">3</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>å¦‚æœæ²¡æœ‰é—®é¢˜çš„è¯ï¼Œä½ åº”è¯¥å¾—åˆ°ä¸€ä¸ªå¯¹è®­ç»ƒé›†100%å‡†ç¡®ç‡ï¼Œå¯¹æµ‹è¯•é›†80%+æ¥è¿‘90%çš„å‡†ç¡®ç‡ã€‚</p>
<h5 id="Step-6-æ¢ç©¶å…¨è¿æ¥ç½‘ç»œ"><a href="#Step-6-æ¢ç©¶å…¨è¿æ¥ç½‘ç»œ" class="headerlink" title="Step 6 æ¢ç©¶å…¨è¿æ¥ç½‘ç»œ"></a>Step 6 æ¢ç©¶å…¨è¿æ¥ç½‘ç»œ</h5><hr>
<p>æˆ‘ä»¬å·²ç»è®­ç»ƒå‡ºäº†ä¸€ä¸ªå·ç§¯ç½‘ç»œï¼Œç°åœ¨æˆ‘ä»¬æ¥æ¢ç©¶ä¸€ä¸‹å…¨è¿æ¥ç½‘ç»œçš„æ•ˆæœã€‚<br>ä½¿ç”¨å®Œå·ç§¯ç½‘ç»œåï¼Œä½ å¯ä»¥åˆ‡æ¢åˆ°å…¨è¿æ¥ç½‘ç»œè¿›è¡Œè®­ç»ƒï¼Œè§‚å¯Ÿæ•ˆæœã€‚<br>ä½ åº”è¯¥ä¼šå‘ç°ï¼Œå…¨è¿æ¥ç½‘ç»œçš„å‡†ç¡®ç‡å¾ˆéš¾è¶…è¿‡60%ã€‚</p>
<h3 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> os

<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> LabelEncoder
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token keyword">from</span> sympy <span class="token keyword">import</span> viete
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>backcompat <span class="token keyword">import</span> keepdim_warning
<span class="token keyword">from</span> torchvision<span class="token punctuation">.</span>transforms <span class="token keyword">import</span> ToTensor
<span class="token keyword">from</span> torch <span class="token keyword">import</span> cuda<span class="token punctuation">,</span> nn<span class="token punctuation">,</span> optim
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">import</span> DataLoader
<span class="token keyword">from</span> tqdm <span class="token keyword">import</span> tqdm

<span class="token keyword">def</span> <span class="token function">check_accuracy</span><span class="token punctuation">(</span>loader<span class="token punctuation">,</span> model<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    num_correct <span class="token operator">=</span> <span class="token number">0</span>
    num_samples <span class="token operator">=</span> <span class="token number">0</span>
    model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Checking accuracy on training data"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Checking accuracy on test data"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Checking accuracy on validation data"</span><span class="token punctuation">)</span>

    <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> loader<span class="token punctuation">:</span>
            x <span class="token operator">=</span> x<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
            y <span class="token operator">=</span> y<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>

            scores <span class="token operator">=</span> model<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
            _<span class="token punctuation">,</span> predictions <span class="token operator">=</span> scores<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            num_correct <span class="token operator">+=</span> <span class="token punctuation">(</span>predictions <span class="token operator">==</span> y<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            num_samples <span class="token operator">+=</span> predictions<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

        <span class="token comment"># Calculate accuracy</span>
        accuracy <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>num_correct<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">float</span><span class="token punctuation">(</span>num_samples<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Got </span><span class="token interpolation"><span class="token punctuation">&#123;</span>num_correct<span class="token punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>num_samples<span class="token punctuation">&#125;</span></span><span class="token string"> with accuracy </span><span class="token interpolation"><span class="token punctuation">&#123;</span>accuracy<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">&#125;</span></span><span class="token string">%"</span></span><span class="token punctuation">)</span>

    model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># Set the model back to training mode</span>
    <span class="token keyword">return</span> accuracy
<span class="token keyword">class</span> <span class="token class-name">Liner</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_size <span class="token operator">=</span> <span class="token number">3</span><span class="token operator">*</span><span class="token number">224</span><span class="token operator">*</span><span class="token number">224</span><span class="token punctuation">,</span> hidden_size<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Liner<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>fc1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>input_size<span class="token punctuation">,</span> hidden_size<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fc2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_size<span class="token punctuation">,</span>   <span class="token number">6</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> x<span class="token punctuation">.</span>view<span class="token punctuation">(</span>x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>fc1<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>fc2<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x

<span class="token keyword">class</span> <span class="token class-name">CNN</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num_classes <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span> in_channels <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>CNN<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels <span class="token operator">=</span> in_channels <span class="token punctuation">,</span> out_channels <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pool1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels <span class="token operator">=</span> <span class="token number">16</span> <span class="token punctuation">,</span> out_channels <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">,</span>  kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fc1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>in_features <span class="token operator">=</span> <span class="token number">32</span> <span class="token operator">*</span> <span class="token number">112</span> <span class="token operator">*</span> <span class="token number">112</span><span class="token punctuation">,</span> out_features <span class="token operator">=</span>  num_classes<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>pool1<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> x<span class="token punctuation">.</span>view<span class="token punctuation">(</span>x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>fc1<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x

<span class="token keyword">class</span> <span class="token class-name">BirdDataset</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> images<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> transform<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>images <span class="token operator">=</span> images
        self<span class="token punctuation">.</span>labels <span class="token operator">=</span> labels
        self<span class="token punctuation">.</span>transform <span class="token operator">=</span> transform <span class="token keyword">if</span> transform <span class="token keyword">else</span> ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>images<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        img_path <span class="token operator">=</span> self<span class="token punctuation">.</span>images<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
        label <span class="token operator">=</span> self<span class="token punctuation">.</span>labels<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
        label <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span>

        <span class="token comment"># åŠ è½½å›¾åƒå¹¶è½¬æ¢ä¸ºPILå›¾åƒ</span>
        image <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>img_path<span class="token punctuation">)</span>

        <span class="token comment"># åº”ç”¨å˜æ¢</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>transform<span class="token punctuation">:</span>
            image <span class="token operator">=</span> self<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>image<span class="token punctuation">)</span>

        <span class="token comment"># è¿”å›å›¾åƒæ•°æ®å’Œå¯¹åº”æ ‡ç­¾</span>
        <span class="token keyword">return</span> image<span class="token punctuation">,</span> label


path <span class="token operator">=</span> <span class="token string">"Bird Species Dataset"</span>
<span class="token comment"># å‡è®¾æ‚¨çš„å›¾ç‰‡éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º 'data' çš„æ–‡ä»¶å¤¹ä¸‹</span>
data_dir <span class="token operator">=</span> path
images <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
writer <span class="token operator">=</span> SummaryWriter<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> root<span class="token punctuation">,</span> dirs<span class="token punctuation">,</span> files <span class="token keyword">in</span> os<span class="token punctuation">.</span>walk<span class="token punctuation">(</span>data_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> f <span class="token keyword">in</span> files<span class="token punctuation">:</span>
        <span class="token keyword">if</span> f<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'.jpg'</span><span class="token punctuation">)</span> <span class="token keyword">or</span> f<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'.png'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root<span class="token punctuation">,</span> f<span class="token punctuation">)</span>
            <span class="token comment"># å­ç›®å½•åç§°ä½œä¸ºæ ‡ç­¾</span>
            label <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>root<span class="token punctuation">)</span>
            images<span class="token punctuation">.</span>append<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
            labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">)</span>
le <span class="token operator">=</span> LabelEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span>
encoded_labels <span class="token operator">=</span> le<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>labels<span class="token punctuation">)</span>
<span class="token comment"># ç¬¬ä¸€æ­¥ï¼šå…ˆå°†æ•´ä¸ªæ•°æ®é›†åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œå…¶ä»–(è¿™é‡ŒåŒ…æ‹¬éªŒè¯é›†+æµ‹è¯•é›†)</span>
train_images<span class="token punctuation">,</span> temp_images<span class="token punctuation">,</span> train_labels<span class="token punctuation">,</span> tmp_labels <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>images<span class="token punctuation">,</span> encoded_labels<span class="token punctuation">,</span>
                                                                       test_size<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span> stratify<span class="token operator">=</span>labels<span class="token punctuation">)</span>  <span class="token comment"># 70% è®­ç»ƒ, 30% å…¶ä»–</span>

<span class="token comment"># ç¬¬äºŒæ­¥ï¼šä»å‰©ä½™çš„æ•°æ®é›†ä¸­å†åˆ’åˆ†å‡ºéªŒè¯é›†å’Œæµ‹è¯•é›†</span>
val_images<span class="token punctuation">,</span> test_images<span class="token punctuation">,</span> val_labels<span class="token punctuation">,</span> test_labels  <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>temp_images<span class="token punctuation">,</span> tmp_labels<span class="token punctuation">,</span>
                                                                     test_size<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span> stratify<span class="token operator">=</span>tmp_labels<span class="token punctuation">)</span>  <span class="token comment"># 15% éªŒè¯, 15% æµ‹è¯•</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"è®­ç»ƒé›†å¤§å°: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>train_images<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"éªŒè¯é›†å¤§å°: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>val_images<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"æµ‹è¯•é›†å¤§å°: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>test_images<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

train_data <span class="token operator">=</span> BirdDataset<span class="token punctuation">(</span>train_images<span class="token punctuation">,</span> train_labels<span class="token punctuation">,</span> transform<span class="token operator">=</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">"cuda"</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"cpu"</span><span class="token punctuation">)</span>
batch_size <span class="token operator">=</span> <span class="token number">64</span>
num_epochs <span class="token operator">=</span> <span class="token number">10</span>
learning_rate <span class="token operator">=</span> <span class="token number">1e-3</span>
model <span class="token operator">=</span> CNN<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
<span class="token comment"># model = Liner().to(device)</span>
criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>
optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>learning_rate<span class="token punctuation">)</span>
train_loader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>dataset <span class="token operator">=</span> train_data<span class="token punctuation">,</span> batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
test_data <span class="token operator">=</span> BirdDataset<span class="token punctuation">(</span>test_images<span class="token punctuation">,</span> test_labels<span class="token punctuation">,</span> transform<span class="token operator">=</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
test_loader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>dataset <span class="token operator">=</span> test_data<span class="token punctuation">,</span> batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Epoch [</span><span class="token interpolation"><span class="token punctuation">&#123;</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>num_epochs<span class="token punctuation">&#125;</span></span><span class="token string">]"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> batch_index<span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">,</span> targets<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>train_loader<span class="token punctuation">)</span><span class="token punctuation">:</span>
        image <span class="token operator">=</span> data<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
        label <span class="token operator">=</span> targets<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
        score <span class="token operator">=</span> model<span class="token punctuation">(</span>image<span class="token punctuation">)</span>
        loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>score<span class="token punctuation">,</span> label<span class="token punctuation">)</span>
        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"loss: "</span><span class="token punctuation">,</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    train_accuracy <span class="token operator">=</span> check_accuracy<span class="token punctuation">(</span>train_loader<span class="token punctuation">,</span> model<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
    test_accuracy <span class="token operator">=</span>  check_accuracy<span class="token punctuation">(</span>test_loader<span class="token punctuation">,</span> model<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>

val_data <span class="token operator">=</span> BirdDataset<span class="token punctuation">(</span>val_images<span class="token punctuation">,</span> val_labels<span class="token punctuation">,</span> transform<span class="token operator">=</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
val_loader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>dataset <span class="token operator">=</span> val_data<span class="token punctuation">,</span> batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
check_accuracy<span class="token punctuation">(</span>val_loader<span class="token punctuation">,</span> model<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">3</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</div></section><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="æ‰“èµ" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><span class="icon iconify" data-icon="ri:hand-coin-line"></span></span><div id="reward-comment">hi, å¯ä»¥è¯·æˆ‘å–æ¯å¥¶èŒ¶å—</div><div id="qr" style="display:none;"><div style="display:inline-block"></div><div style="display:inline-block"></div><div style="display:inline-block"></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>æœ¬æ–‡ä½œè€…ï¼š</strong>yongxu</li><li class="post-copyright-link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="https://yongxuqixiang.github.io/yongxu.github.io/2024/10/31/pytorch%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C-Lecture1/" title="å¦‚ä½•å¼€å§‹ä½ çš„ç¬¬ä¸€ä¸ªç¥ç»ç½‘ç»œ">https://yongxuqixiang.github.io/yongxu.github.io/2024/10/31/pytorch%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C-Lecture1/</a></li><li class="post-copyright-license"><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é»˜è®¤é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> è®¸å¯åè®®ã€‚</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/yongxu.github.io/2024/11/13/c++L2%E9%87%8D%E8%BD%BD/" rel="prev" title="ç±»-L2-é‡è½½&amp;&amp;å‹å…ƒå‡½æ•°"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">ç±»-L2-é‡è½½&amp;&amp;å‹å…ƒå‡½æ•°</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/yongxu.github.io/2024/10/27/docker(Ubuntu)/" rel="next" title="Docker(Ubuntu)"><span class="post-nav-text">Docker(Ubuntu)</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2024 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> yongxuqixiang</span></div><div class="powered"><span>ç”± <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> é©±åŠ¨ v7.3.0</span><span class="footer-separator">|</span><span>ä¸»é¢˜ - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.11</span></div><div id="busuanzi"><span id="busuanzi_container_site_uv" title="æ€»è®¿å®¢é‡"><span><span class="icon iconify" data-icon="ri:user-line"></span></span><span id="busuanzi_value_site_uv"></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" title="æ€»è®¿é—®é‡"><span><span class="icon iconify" data-icon="ri:eye-line"></span></span><span id="busuanzi_value_site_pv"></span></span><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#6200ee" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="æœç´¢"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:search-line"></span></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="https://fastly.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js"></script><script src="/yongxu.github.io/js/search/local-search.js" defer type="module"></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><span class="icon iconify" data-icon="ri:close-line"></span></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="æœç´¢..." value=""></div><div class="search-result-container"></div></div><script>function initMourn() {
  const date = new Date();
  const today = (date.getMonth() + 1) + "-" + date.getDate()
  const mourn_days = ["4-4","9-18"]
  if (mourn_days.includes(today)) {
    document.documentElement.style.filter = "grayscale(1)";
  }
}
initMourn();</script><script src="https://fastly.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script>const images = [...document.querySelectorAll('.markdown-body img')]
mediumZoom(images)</script><style>.medium-zoom-image {
  z-index: 99;
}</style><!-- hexo injector body_end start --><script src="https://cdn.jsdelivr.net/npm/hexo-widget-tree@0.2.3/js/index.js"></script><div id="widget-tree">
      <ul>
      <li class="tree-list-item">
        <i class="toggle-post-icon gg-folder-add"></i>
        <a class="tree-list-link" href="/yongxu.github.io/categories/c-%E7%AC%94%E8%AE%B0/">
          c++ç¬”è®°
        </a>
      <span class="tree-list-count">2</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/yongxu.github.io/2024/10/22/c++L1%E5%88%9D%E6%AD%A5/" title="ç±»-L1-åˆæ­¥è®¤è¯†"><i class="post-icon gg-file-document"></i>ç±»-L1-åˆæ­¥è®¤è¯†</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/yongxu.github.io/2024/11/13/c++L2%E9%87%8D%E8%BD%BD/" title="ç±»-L2-é‡è½½&&å‹å…ƒå‡½æ•°"><i class="post-icon gg-file-document"></i>ç±»-L2-é‡è½½&&å‹å…ƒå‡½æ•°</a></li></ul></li>
      <li class="tree-list-item">
        <i class="toggle-post-icon gg-folder-add"></i>
        <a class="tree-list-link" href="/yongxu.github.io/categories/docker/">
          docker
        </a>
      <span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/yongxu.github.io/2024/10/27/docker(Ubuntu)/" title="Docker(Ubuntu)"><i class="post-icon gg-file-document"></i>Docker(Ubuntu)</a></li></ul></li>
      <li class="tree-list-item">
        <i class="toggle-post-icon gg-folder-add"></i>
        <a class="tree-list-link" href="/yongxu.github.io/categories/deep-learning/">
          deep-learning
        </a>
      <span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/yongxu.github.io/2024/10/31/pytorch%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C-Lecture1/" title="å¦‚ä½•å¼€å§‹ä½ çš„ç¬¬ä¸€ä¸ªç¥ç»ç½‘ç»œ"><i class="post-icon gg-file-document"></i>å¦‚ä½•å¼€å§‹ä½ çš„ç¬¬ä¸€ä¸ªç¥ç»ç½‘ç»œ</a></li></ul></li></ul>
        <div id="widget-tree-button">
          <i class="gg-chevron-right"></i>
        </div>
      </div><!-- hexo injector body_end end --></body></html>